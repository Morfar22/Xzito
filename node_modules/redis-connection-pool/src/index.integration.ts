import { expect } from 'chai';
// import * as sinon from 'sinon';
import redisConnectionPoolFactory from './index';

describe('Redis Pool', () => {
  let pool;
  beforeEach(async () => {
    console.log('init');
    pool = redisConnectionPoolFactory('redisPoolTest1', {
      max_clients: 5,
      redis: {
        url: '127.0.0.1:6379',
        database: 1
      },
    });
    await pool.init();
  });

  afterEach(() => {
    console.log('clean');
    pool.clean('*');
    pool = undefined;
  });

  it('can connect to database', () => {
    expect(typeof pool).to.eql('object');
    expect(pool.uid).to.eql('redisPoolTest1');
    expect(pool.redis.url).to.eql('127.0.0.1:6379');
  });

  describe('store and fetch', () => {
    console.log('-0')

    it('set', async () => {
      console.log('-1')
      expect(await pool.set('an id', 'a value')).to.eql('OK');
    });
    it('get', async () => {
      console.log('-2')
      expect(await pool.get('an id')).to.equal('a value');
    });
  });

});
